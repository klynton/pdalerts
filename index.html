<html>
<head>
  <title>Pagerduty alerts</title>
  <style>
    * {
      font-family: sans-serif;
    }

    table, tr, td {
      padding: 0;
    }

    #chart table tr.header th:first-child span {
      display: none;
    }

    #chart table tr td {
      display: block;
      height: 30px;
      width: 30px;
    }

    #chart table tr td span {
      display: none;
      text-align: center;
      color: #fff;
    }

    #chart table tr td:hover span {
      display: block;
    }
  </style>
</head>

<div id="chart"></div>

<script src="http://d3js.org/d3.v2.js"></script>
<script>
var days = [],
    day_names = ["SU", "MO", "TU", "WE", "TH", "FR", "SA"];

for (var i=0; i<7; i++) {
  days[i] = [];
  for (var j=0; j<24; j++) {
    days[i][j] = 0;
  };
};

var color = d3.scale.log()
              .domain([1, 50])
              .range(["#ddd", "#333"]),
    table = d3.select("#chart").append("table"),
    header = table.append("tr").attr("class", "header")
              .selectAll("th").data(d3.range(-1, 24)).enter()
              .append("th").append("span").text(function (d) { return "" + d; });

d3.csv("data.csv", function (data) {
  data.forEach(function (row) {
    var day_of_week = parseInt(row.day_of_week),
        hour = parseInt(row.hour);
    days[day_of_week][hour] += 1;
  });

  table.selectAll("tr.data").data(days).enter().append("tr").attr("class", "data");

  table.selectAll("tr.data").each(function (d, i) {
    var row = d3.select(this);
    row.insert("th").append("span").text(day_names[i]);

    row.selectAll("td")
        .data(d).enter().append("td")
        .attr("style", function (d) { return "background: " + color(d) + ";"})
        .append("span").text(function (d) {return d; })
  });

});
</script>
</html>
