<html>
<head>
  <title>Pagerduty alerts</title>
  <style>
    * {
      font-family: sans-serif;
    }

    table, tr, td {
      padding: 0;
    }

    #chart table tr td {
      display: block;
      height: 30px;
      width: 30px;
    }

    #chart table tr td span {
      display: none;
      text-align: center;
      color: #fff;
    }

    #chart table tr td:hover span {
      display: block;
    }
  </style>
</head>

<div id="chart"></div>

<script src="http://d3js.org/d3.v2.js"></script>
<script src="https://raw.github.com/mbostock/d3/master/lib/colorbrewer/colorbrewer.js"></script>
<script>
var days = [];

for (var i=0; i<7; i++) {
  days[i] = [];
  for (var j=0; j<24; j++) {
    days[i][j] = 0;
  };
};

var color = d3.scale.log()
              .domain([1, 50])
              .range(["#ccc", "#111"]),
    table = d3.select("#chart").append("table");

table.append("tr").attr("class", "header")
    .selectAll("th").data(d3.range(0, 24)).enter()
    .append("th").text(function (d) { return "" + d; });

d3.csv("data.csv", function (data) {
  data.forEach(function (row) {
    var day_of_week = parseInt(row.day_of_week),
        hour = parseInt(row.hour);
    days[day_of_week][hour] += 1;
  });

  table.selectAll("tr.data").data(days).enter().append("tr").attr("class", "data");

  table.selectAll("tr.data").each(function (d, i) {
    d3.select(this).selectAll("td")
        .data(d).enter().append("td")
        .attr("style", function (d) { return "background: " + color(d) + ";"})
        .append("span").text(function (d) {return d; })
  });

});

    /*
    rows = table.selectAll("tr")
              .data(d3.range(0, 7)).enter().append("tr")
            .each(function (d, i) {
              console.log(d, i, this);
              this.selectAll("td");
            });
            ).selecttAll("td")
              .data(d3.range(0, 24)).enter().append("td");
            */
    
/*
d3.csv("data.csv", function (data) {
  data.forEach(function (row) {
    var day_of_week = parseInt(row.day_of_week),
        hour = parseInt(row.hour);
    days[day_of_week][hour] += 1;
  });

  rows.forEach(function (row, i) {
    row.selectAll("td")
      .data(days[i]).enter().append("td");
  });

});
*/
</script>
</html>
